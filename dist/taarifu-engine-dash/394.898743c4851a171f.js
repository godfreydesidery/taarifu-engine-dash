"use strict";(self.webpackChunktaarifu_engine_dash=self.webpackChunktaarifu_engine_dash||[]).push([[394],{4394:(E,g,o)=>{o.r(g),o.d(g,{DistrictListComponent:()=>F});var d=o(177),u=o(1069),c=o(4341),t=o(4438),_=o(3446),h=o(8010),p=o(5423);function m(n,a){1&n&&(t.j41(0,"div",26)(1,"div",27)(2,"span",28),t.EFF(3,"Loading..."),t.k0s()(),t.j41(4,"p",29),t.EFF(5,"Loading districts..."),t.k0s()())}function b(n,a){1&n&&(t.j41(0,"div",30),t.nrm(1,"i",31),t.j41(2,"h4",32),t.EFF(3,"No districts found"),t.k0s(),t.j41(4,"p",3),t.EFF(5,"Start by creating your first district."),t.k0s(),t.j41(6,"a",4),t.nrm(7,"i",5),t.EFF(8," Add District "),t.k0s()())}function v(n,a){if(1&n){const e=t.RV6();t.j41(0,"tr")(1,"td")(2,"span",39),t.EFF(3),t.k0s()(),t.j41(4,"td")(5,"strong"),t.EFF(6),t.k0s()(),t.j41(7,"td")(8,"span",40),t.EFF(9),t.k0s()(),t.j41(10,"td"),t.EFF(11),t.k0s(),t.j41(12,"td"),t.EFF(13),t.nI1(14,"number"),t.k0s(),t.j41(15,"td"),t.EFF(16),t.nI1(17,"number"),t.k0s(),t.j41(18,"td")(19,"span",41),t.EFF(20),t.k0s()(),t.j41(21,"td")(22,"div",42)(23,"button",43),t.bIt("click",function(){const s=t.eBV(e).$implicit,r=t.XpG(2);return t.Njj(r.editDistrict(s))}),t.nrm(24,"i",44),t.k0s(),t.j41(25,"button",45),t.bIt("click",function(){const s=t.eBV(e).$implicit,r=t.XpG(2);return t.Njj(r.toggleStatus(s))}),t.nrm(26,"i",37),t.k0s(),t.j41(27,"button",46),t.bIt("click",function(){const s=t.eBV(e).$implicit,r=t.XpG(2);return t.Njj(r.deleteDistrict(s))}),t.nrm(28,"i",47),t.k0s()()()()}if(2&n){const e=a.$implicit;t.R7$(3),t.JRh(e.code),t.R7$(3),t.JRh(e.name),t.R7$(3),t.JRh(e.regionName),t.R7$(2),t.JRh(e.headquarters),t.R7$(2),t.JRh(t.bMT(14,15,e.population)),t.R7$(3),t.JRh(t.i5U(17,17,e.areaSqKm,"1.2-2")),t.R7$(3),t.AVh("bg-success",e.isActive)("bg-secondary",!e.isActive),t.R7$(),t.SpI(" ",e.isActive?"Active":"Inactive"," "),t.R7$(6),t.AVh("bi-pause",e.isActive)("bi-play",!e.isActive)}}function D(n,a){if(1&n){const e=t.RV6();t.j41(0,"div",33)(1,"table",34)(2,"thead",35)(3,"tr")(4,"th",36),t.bIt("click",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onSort("code",s))}),t.EFF(5," Code "),t.nrm(6,"i",37),t.k0s(),t.j41(7,"th",36),t.bIt("click",function(s){t.eBV(e);const r=t.XpG();return t.Njj(r.onSort("name",s))}),t.EFF(8," Name "),t.nrm(9,"i",37),t.k0s(),t.j41(10,"th"),t.EFF(11,"Region"),t.k0s(),t.j41(12,"th"),t.EFF(13,"Headquarters"),t.k0s(),t.j41(14,"th"),t.EFF(15,"Population"),t.k0s(),t.j41(16,"th"),t.EFF(17,"Area (km\xb2)"),t.k0s(),t.j41(18,"th"),t.EFF(19,"Status"),t.k0s(),t.j41(20,"th"),t.EFF(21,"Actions"),t.k0s()()(),t.j41(22,"tbody"),t.DNE(23,v,29,20,"tr",38),t.k0s()()()}if(2&n){const e=t.XpG();t.R7$(6),t.AVh("bi-arrow-up","code"===e.sortBy&&"asc"===e.sortDir)("bi-arrow-down","code"===e.sortBy&&"desc"===e.sortDir),t.R7$(3),t.AVh("bi-arrow-up","name"===e.sortBy&&"asc"===e.sortDir)("bi-arrow-down","name"===e.sortBy&&"desc"===e.sortDir),t.R7$(14),t.Y8G("ngForOf",e.districts)}}function f(n,a){if(1&n){const e=t.RV6();t.j41(0,"li",50)(1,"button",53),t.bIt("click",function(){const s=t.eBV(e).$implicit,r=t.XpG(2);return t.Njj(r.goToPage(s))}),t.EFF(2),t.k0s()()}if(2&n){const e=a.$implicit,i=t.XpG(2);t.AVh("active",e===i.currentPage),t.R7$(2),t.JRh(e+1)}}function k(n,a){if(1&n){const e=t.RV6();t.j41(0,"nav",48)(1,"ul",49)(2,"li",50)(3,"button",51),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.goToPage(s.currentPage-1))}),t.EFF(4,"Previous"),t.k0s()(),t.DNE(5,f,3,3,"li",52),t.j41(6,"li",50)(7,"button",51),t.bIt("click",function(){t.eBV(e);const s=t.XpG();return t.Njj(s.goToPage(s.currentPage+1))}),t.EFF(8,"Next"),t.k0s()()()()}if(2&n){const e=t.XpG();t.R7$(2),t.AVh("disabled",0===e.currentPage),t.R7$(),t.Y8G("disabled",0===e.currentPage),t.R7$(2),t.Y8G("ngForOf",e.getPageNumbers()),t.R7$(),t.AVh("disabled",e.currentPage===e.totalPages-1),t.R7$(),t.Y8G("disabled",e.currentPage===e.totalPages-1)}}let F=(()=>{class n{constructor(e,i,s,r){this.districtService=e,this.authService=i,this.router=s,this.toastService=r,this.districts=[],this.searchTerm="",this.isLoading=!1,this.currentPage=0,this.pageSize=10,this.totalPages=0,this.totalElements=0,this.sortBy="name",this.sortDir="asc"}ngOnInit(){console.log("DistrictListComponent initialized");const e=this.authService.getToken(),i=this.authService.isAuthenticated(),s=this.authService.getCurrentUser();if(console.log("Auth Debug Info:"),console.log("- Token exists:",!!e),console.log("- Token value:",e?e.substring(0,50)+"...":"No token"),console.log("- Is authenticated:",i),console.log("- Current user:",s),!i)return console.error("User not authenticated! Redirecting to login..."),void this.router.navigate(["/login"]);this.loadDistricts()}loadDistricts(){this.isLoading=!0,(this.searchTerm?this.districtService.searchDistricts(this.searchTerm,this.currentPage,this.pageSize,this.sortBy,this.sortDir):this.districtService.getAllDistricts(this.currentPage,this.pageSize,this.sortBy,this.sortDir)).subscribe({next:i=>{this.isLoading=!1,this.districts=i.data||[],this.totalElements=i.totalElements||0,this.totalPages=i.totalPages||0},error:i=>{this.isLoading=!1,console.error("Error loading districts:",i),console.error("Error status:",i.status),console.error("Error details:",i.error),403===i.status?(console.error("403 Forbidden - Authentication/Authorization issue"),console.error("Current token:",this.authService.getToken()),this.toastService.error("Access Denied","Please log in again."),this.authService.logout(),this.router.navigate(["/login"])):401===i.status?(console.error("401 Unauthorized - Token expired or invalid"),this.toastService.error("Session Expired","Please log in again."),this.authService.logout(),this.router.navigate(["/login"])):this.toastService.error("Error Loading Districts",i.error?.message||i.message||"Unknown error occurred")}})}onSearch(){this.currentPage=0,this.loadDistricts()}onPageSizeChange(){this.currentPage=0,this.loadDistricts()}onSort(e,i){i.preventDefault(),this.sortBy===e?this.sortDir="asc"===this.sortDir?"desc":"asc":(this.sortBy=e,this.sortDir="asc"),this.currentPage=0,this.loadDistricts()}goToPage(e){e>=0&&e<this.totalPages&&(this.currentPage=e,this.loadDistricts())}getPageNumbers(){const e=[],i=Math.max(0,this.currentPage-2),s=Math.min(this.totalPages-1,this.currentPage+2);for(let r=i;r<=s;r++)e.push(r);return e}editDistrict(e){window.location.href=`/districts/edit/${e.uid}`}toggleStatus(e){this.districtService.toggleDistrictStatus(e.uid).subscribe({next:i=>{i.success&&(this.toastService.success("District Updated",`District ${i.data.isActive?"activated":"deactivated"} successfully`),this.loadDistricts())},error:i=>{console.error("Error toggling district status:",i),this.toastService.error("Error Updating District","Failed to update district status")}})}deleteDistrict(e){confirm(`Are you sure you want to delete district "${e.name}"?`)&&this.districtService.deleteDistrict(e.uid).subscribe({next:i=>{i.success&&(this.toastService.success("District Deleted","District deleted successfully"),this.loadDistricts())},error:i=>{console.error("Error deleting district:",i),this.toastService.error("Error Deleting District","Failed to delete district")}})}static{this.\u0275fac=function(i){return new(i||n)(t.rXU(_.m),t.rXU(h.u),t.rXU(u.Ix),t.rXU(p.f))}}static{this.\u0275cmp=t.VBU({type:n,selectors:[["app-district-list"]],standalone:!0,features:[t.aNF],decls:40,vars:10,consts:[[1,"container-fluid"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"h3","mb-1"],[1,"text-muted"],["routerLink","/districts/create",1,"btn","btn-primary"],[1,"bi","bi-plus-circle","me-1"],[1,"card","mb-4"],[1,"card-body"],[1,"row"],[1,"col-md-6"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-search"],["type","text","placeholder","Search districts...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],[1,"card"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"card-title","mb-0"],[1,"bi","bi-building","me-2"],[1,"d-flex","align-items-center"],[1,"text-muted","me-2"],[1,"form-select","form-select-sm","w-auto",3,"ngModelChange","change","ngModel"],[3,"value"],["class","text-center py-4",4,"ngIf"],["class","text-center py-5",4,"ngIf"],["class","table-responsive",4,"ngIf"],["aria-label","Page navigation",4,"ngIf"],[1,"text-center","py-4"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],[1,"text-center","py-5"],[1,"bi","bi-building","text-muted",2,"font-size","3rem"],[1,"text-muted","mt-3"],[1,"table-responsive"],[1,"table","table-hover"],[1,"table-light"],[1,"sortable",3,"click"],[1,"bi"],[4,"ngFor","ngForOf"],[1,"badge","bg-primary"],[1,"badge","bg-success"],[1,"badge"],["role","group",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"bi","bi-pencil"],["type","button",1,"btn","btn-outline-warning",3,"click"],["type","button",1,"btn","btn-outline-danger",3,"click"],[1,"bi","bi-trash"],["aria-label","Page navigation"],[1,"pagination","justify-content-center"],[1,"page-item"],[1,"page-link",3,"click","disabled"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"page-link",3,"click"]],template:function(i,s){1&i&&(t.j41(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),t.EFF(4,"Districts"),t.k0s(),t.j41(5,"p",3),t.EFF(6,"Manage Tanzania districts"),t.k0s()(),t.j41(7,"a",4),t.nrm(8,"i",5),t.EFF(9," Add District "),t.k0s()(),t.j41(10,"div",6)(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10)(15,"span",11),t.nrm(16,"i",12),t.k0s(),t.j41(17,"input",13),t.mxI("ngModelChange",function(l){return t.DH7(s.searchTerm,l)||(s.searchTerm=l),l}),t.bIt("keyup.enter",function(){return s.onSearch()}),t.k0s()()()()()(),t.j41(18,"div",14)(19,"div",15)(20,"h5",16),t.nrm(21,"i",17),t.EFF(22," All Districts "),t.k0s(),t.j41(23,"div",18)(24,"span",19),t.EFF(25,"Page Size:"),t.k0s(),t.j41(26,"select",20),t.mxI("ngModelChange",function(l){return t.DH7(s.pageSize,l)||(s.pageSize=l),l}),t.bIt("change",function(){return s.onPageSizeChange()}),t.j41(27,"option",21),t.EFF(28,"10"),t.k0s(),t.j41(29,"option",21),t.EFF(30,"25"),t.k0s(),t.j41(31,"option",21),t.EFF(32,"50"),t.k0s(),t.j41(33,"option",21),t.EFF(34,"100"),t.k0s()()()(),t.j41(35,"div",7),t.DNE(36,m,6,0,"div",22)(37,b,9,0,"div",23)(38,D,24,9,"div",24)(39,k,9,7,"nav",25),t.k0s()()()),2&i&&(t.R7$(17),t.R50("ngModel",s.searchTerm),t.R7$(9),t.R50("ngModel",s.pageSize),t.R7$(),t.Y8G("value",10),t.R7$(2),t.Y8G("value",25),t.R7$(2),t.Y8G("value",50),t.R7$(2),t.Y8G("value",100),t.R7$(3),t.Y8G("ngIf",s.isLoading),t.R7$(),t.Y8G("ngIf",!s.isLoading&&0===s.districts.length),t.R7$(),t.Y8G("ngIf",!s.isLoading&&s.districts.length>0),t.R7$(),t.Y8G("ngIf",!s.isLoading&&s.totalPages>1))},dependencies:[d.MD,d.Sq,d.bT,d.QX,u.iI,u.Wk,c.YN,c.xH,c.y7,c.me,c.wz,c.BC,c.vS],styles:[".container-fluid[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 1rem}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;font-weight:600;color:#495057}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:.25rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:not(:last-child){margin-right:2px}.badge[_ngcontent-%COMP%]{font-size:.75em}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}.sortable[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:5px;font-size:.7em}"]})}}return n})()}}]);