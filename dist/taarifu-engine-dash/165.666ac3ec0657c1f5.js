"use strict";(self.webpackChunktaarifu_engine_dash=self.webpackChunktaarifu_engine_dash||[]).push([[165],{4165:(j,u,o)=>{o.r(u),o.d(u,{HamletListComponent:()=>E});var m=o(177),g=o(1069),r=o(4341),t=o(4438),h=o(891),d=o(8010),_=o(5423);function p(s,l){1&s&&(t.j41(0,"div",26)(1,"div",27)(2,"span",28),t.EFF(3,"Loading..."),t.k0s()(),t.j41(4,"p",29),t.EFF(5,"Loading hamlets..."),t.k0s()())}function b(s,l){1&s&&(t.j41(0,"div",30),t.nrm(1,"i",31),t.j41(2,"h4",32),t.EFF(3,"No hamlets found"),t.k0s(),t.j41(4,"p",3),t.EFF(5,"Start by creating your first hamlet."),t.k0s(),t.j41(6,"a",4),t.nrm(7,"i",5),t.EFF(8," Add Hamlet "),t.k0s()())}function v(s,l){if(1&s){const e=t.RV6();t.j41(0,"tr")(1,"td")(2,"span",39),t.EFF(3),t.k0s()(),t.j41(4,"td")(5,"strong"),t.EFF(6),t.k0s()(),t.j41(7,"td")(8,"span",40),t.EFF(9),t.k0s()(),t.j41(10,"td")(11,"span",41),t.EFF(12),t.k0s()(),t.j41(13,"td")(14,"span",42),t.EFF(15),t.k0s()(),t.j41(16,"td")(17,"span",43),t.EFF(18),t.k0s()(),t.j41(19,"td"),t.EFF(20),t.k0s(),t.j41(21,"td"),t.EFF(22),t.nI1(23,"number"),t.k0s(),t.j41(24,"td")(25,"span",44),t.EFF(26),t.k0s()(),t.j41(27,"td")(28,"div",45)(29,"button",46),t.bIt("click",function(){const i=t.eBV(e).$implicit,a=t.XpG(2);return t.Njj(a.editHamlet(i))}),t.nrm(30,"i",47),t.k0s(),t.j41(31,"button",48),t.bIt("click",function(){const i=t.eBV(e).$implicit,a=t.XpG(2);return t.Njj(a.toggleStatus(i))}),t.nrm(32,"i",37),t.k0s(),t.j41(33,"button",49),t.bIt("click",function(){const i=t.eBV(e).$implicit,a=t.XpG(2);return t.Njj(a.deleteHamlet(i))}),t.nrm(34,"i",50),t.k0s()()()()}if(2&s){const e=l.$implicit;t.R7$(3),t.JRh(e.code),t.R7$(3),t.JRh(e.name),t.R7$(3),t.JRh(e.villageName),t.R7$(3),t.JRh(e.wardName),t.R7$(3),t.JRh(e.districtName),t.R7$(3),t.JRh(e.regionName),t.R7$(2),t.JRh(e.headquarters),t.R7$(2),t.JRh(t.bMT(23,17,e.population)),t.R7$(3),t.AVh("bg-success",e.isActive)("bg-secondary",!e.isActive),t.R7$(),t.SpI(" ",e.isActive?"Active":"Inactive"," "),t.R7$(6),t.AVh("bi-pause",e.isActive)("bi-play",!e.isActive)}}function f(s,l){if(1&s){const e=t.RV6();t.j41(0,"div",33)(1,"table",34)(2,"thead",35)(3,"tr")(4,"th",36),t.bIt("click",function(i){t.eBV(e);const a=t.XpG();return t.Njj(a.onSort("code",i))}),t.EFF(5," Code "),t.nrm(6,"i",37),t.k0s(),t.j41(7,"th",36),t.bIt("click",function(i){t.eBV(e);const a=t.XpG();return t.Njj(a.onSort("name",i))}),t.EFF(8," Name "),t.nrm(9,"i",37),t.k0s(),t.j41(10,"th"),t.EFF(11,"Village"),t.k0s(),t.j41(12,"th"),t.EFF(13,"Ward"),t.k0s(),t.j41(14,"th"),t.EFF(15,"District"),t.k0s(),t.j41(16,"th"),t.EFF(17,"Region"),t.k0s(),t.j41(18,"th"),t.EFF(19,"Headquarters"),t.k0s(),t.j41(20,"th"),t.EFF(21,"Population"),t.k0s(),t.j41(22,"th"),t.EFF(23,"Status"),t.k0s(),t.j41(24,"th"),t.EFF(25,"Actions"),t.k0s()()(),t.j41(26,"tbody"),t.DNE(27,v,35,19,"tr",38),t.k0s()()()}if(2&s){const e=t.XpG();t.R7$(6),t.AVh("bi-arrow-up","code"===e.sortBy&&"asc"===e.sortDir)("bi-arrow-down","code"===e.sortBy&&"desc"===e.sortDir),t.R7$(3),t.AVh("bi-arrow-up","name"===e.sortBy&&"asc"===e.sortDir)("bi-arrow-down","name"===e.sortBy&&"desc"===e.sortDir),t.R7$(18),t.Y8G("ngForOf",e.hamlets)}}function F(s,l){if(1&s){const e=t.RV6();t.j41(0,"li",53)(1,"button",56),t.bIt("click",function(){const i=t.eBV(e).$implicit,a=t.XpG(2);return t.Njj(a.goToPage(i))}),t.EFF(2),t.k0s()()}if(2&s){const e=l.$implicit,n=t.XpG(2);t.AVh("active",e===n.currentPage),t.R7$(2),t.JRh(e+1)}}function k(s,l){if(1&s){const e=t.RV6();t.j41(0,"nav",51)(1,"ul",52)(2,"li",53)(3,"button",54),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.goToPage(i.currentPage-1))}),t.EFF(4,"Previous"),t.k0s()(),t.DNE(5,F,3,3,"li",55),t.j41(6,"li",53)(7,"button",54),t.bIt("click",function(){t.eBV(e);const i=t.XpG();return t.Njj(i.goToPage(i.currentPage+1))}),t.EFF(8,"Next"),t.k0s()()()()}if(2&s){const e=t.XpG();t.R7$(2),t.AVh("disabled",0===e.currentPage),t.R7$(),t.Y8G("disabled",0===e.currentPage),t.R7$(2),t.Y8G("ngForOf",e.getPageNumbers()),t.R7$(),t.AVh("disabled",e.currentPage===e.totalPages-1),t.R7$(),t.Y8G("disabled",e.currentPage===e.totalPages-1)}}let E=(()=>{class s{constructor(e,n,i,a){this.hamletService=e,this.authService=n,this.router=i,this.toastService=a,this.hamlets=[],this.searchTerm="",this.currentPage=0,this.pageSize=10,this.totalElements=0,this.totalPages=0,this.sortBy="name",this.sortDir="asc",this.isLoading=!1}ngOnInit(){console.log("HamletListComponent initialized");const e=this.authService.getToken(),n=this.authService.isAuthenticated(),i=this.authService.getCurrentUser();if(console.log("Auth Debug Info:"),console.log("- Token exists:",!!e),console.log("- Token value:",e?e.substring(0,50)+"...":"No token"),console.log("- Is authenticated:",n),console.log("- Current user:",i),!n)return console.error("User not authenticated! Redirecting to login..."),void this.router.navigate(["/login"]);this.loadHamlets()}loadHamlets(){this.isLoading=!0,(this.searchTerm?this.hamletService.searchHamlets(this.searchTerm,this.currentPage,this.pageSize,this.sortBy,this.sortDir):this.hamletService.getAllHamlets(this.currentPage,this.pageSize,this.sortBy,this.sortDir)).subscribe({next:n=>{this.isLoading=!1,console.log("Hamlets API Response:",n),this.hamlets=n.data||[],this.totalElements=n.totalElements||0,this.totalPages=n.totalPages||0,console.log("Loaded hamlets:",this.hamlets.length)},error:n=>{this.isLoading=!1,console.error("Error loading hamlets:",n),console.error("Error status:",n.status),console.error("Error details:",n.error),403===n.status?(console.error("403 Forbidden - Authentication/Authorization issue"),console.error("Current token:",this.authService.getToken()),this.toastService.error("Access Denied","Please log in again."),this.authService.logout(),this.router.navigate(["/login"])):401===n.status?(console.error("401 Unauthorized - Token expired or invalid"),this.toastService.error("Session Expired","Please log in again."),this.authService.logout(),this.router.navigate(["/login"])):this.toastService.error("Error Loading Hamlets",n.error?.message||n.message||"Unknown error occurred")}})}onSearch(){this.currentPage=0,this.loadHamlets()}onPageSizeChange(){this.currentPage=0,this.loadHamlets()}onSort(e,n){n.preventDefault(),this.sortBy===e?this.sortDir="asc"===this.sortDir?"desc":"asc":(this.sortBy=e,this.sortDir="asc"),this.currentPage=0,this.loadHamlets()}goToPage(e){this.currentPage=e,this.loadHamlets()}getPageNumbers(){const e=[];for(let n=0;n<this.totalPages;n++)e.push(n);return e}editHamlet(e){this.router.navigate(["/hamlets/edit",e.uid])}toggleStatus(e){this.hamletService.toggleHamletStatus(e.uid).subscribe({next:n=>{n.status&&(this.toastService.success("Hamlet Updated",`Hamlet ${n.data.isActive?"activated":"deactivated"} successfully`),this.loadHamlets())},error:n=>{console.error("Error toggling hamlet status:",n),this.toastService.error("Error Updating Hamlet","Failed to update hamlet status")}})}deleteHamlet(e){confirm(`Are you sure you want to delete hamlet "${e.name}"?`)&&this.hamletService.deleteHamlet(e.uid).subscribe({next:n=>{n.status&&(this.toastService.success("Hamlet Deleted","Hamlet deleted successfully"),this.loadHamlets())},error:n=>{console.error("Error deleting hamlet:",n),this.toastService.error("Error Deleting Hamlet","Failed to delete hamlet")}})}static{this.\u0275fac=function(n){return new(n||s)(t.rXU(h.x),t.rXU(d.u),t.rXU(g.Ix),t.rXU(_.f))}}static{this.\u0275cmp=t.VBU({type:s,selectors:[["app-hamlet-list"]],standalone:!0,features:[t.aNF],decls:40,vars:10,consts:[[1,"container-fluid"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"h3","mb-1"],[1,"text-muted"],["routerLink","/hamlets/create",1,"btn","btn-primary"],[1,"bi","bi-plus-circle","me-1"],[1,"card","mb-4"],[1,"card-body"],[1,"row"],[1,"col-md-6"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-search"],["type","text","placeholder","Search hamlets...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],[1,"card"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"card-title","mb-0"],[1,"bi","bi-house-door-fill","me-2"],[1,"d-flex","align-items-center"],[1,"text-muted","me-2"],[1,"form-select","form-select-sm","w-auto",3,"ngModelChange","change","ngModel"],[3,"value"],["class","text-center py-4",4,"ngIf"],["class","text-center py-5",4,"ngIf"],["class","table-responsive",4,"ngIf"],["aria-label","Page navigation",4,"ngIf"],[1,"text-center","py-4"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],[1,"text-center","py-5"],[1,"bi","bi-house-door-fill","text-muted",2,"font-size","3rem"],[1,"text-muted","mt-3"],[1,"table-responsive"],[1,"table","table-hover"],[1,"table-light"],[1,"sortable",3,"click"],[1,"bi"],[4,"ngFor","ngForOf"],[1,"badge","bg-primary"],[1,"badge","bg-info"],[1,"badge","bg-secondary"],[1,"badge","bg-warning","text-dark"],[1,"badge","bg-success"],[1,"badge"],["role","group",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"bi","bi-pencil"],["type","button",1,"btn","btn-outline-warning",3,"click"],["type","button",1,"btn","btn-outline-danger",3,"click"],[1,"bi","bi-trash"],["aria-label","Page navigation"],[1,"pagination","justify-content-center"],[1,"page-item"],[1,"page-link",3,"click","disabled"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"page-link",3,"click"]],template:function(n,i){1&n&&(t.j41(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),t.EFF(4,"Hamlets"),t.k0s(),t.j41(5,"p",3),t.EFF(6,"Manage Tanzania hamlets"),t.k0s()(),t.j41(7,"a",4),t.nrm(8,"i",5),t.EFF(9," Add New Hamlet "),t.k0s()(),t.j41(10,"div",6)(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10)(15,"span",11),t.nrm(16,"i",12),t.k0s(),t.j41(17,"input",13),t.mxI("ngModelChange",function(c){return t.DH7(i.searchTerm,c)||(i.searchTerm=c),c}),t.bIt("keyup.enter",function(){return i.onSearch()}),t.k0s()()()()()(),t.j41(18,"div",14)(19,"div",15)(20,"h5",16),t.nrm(21,"i",17),t.EFF(22," All Hamlets "),t.k0s(),t.j41(23,"div",18)(24,"span",19),t.EFF(25,"Page Size:"),t.k0s(),t.j41(26,"select",20),t.mxI("ngModelChange",function(c){return t.DH7(i.pageSize,c)||(i.pageSize=c),c}),t.bIt("change",function(){return i.onPageSizeChange()}),t.j41(27,"option",21),t.EFF(28,"10"),t.k0s(),t.j41(29,"option",21),t.EFF(30,"25"),t.k0s(),t.j41(31,"option",21),t.EFF(32,"50"),t.k0s(),t.j41(33,"option",21),t.EFF(34,"100"),t.k0s()()()(),t.j41(35,"div",7),t.DNE(36,p,6,0,"div",22)(37,b,9,0,"div",23)(38,f,28,9,"div",24)(39,k,9,7,"nav",25),t.k0s()()()),2&n&&(t.R7$(17),t.R50("ngModel",i.searchTerm),t.R7$(9),t.R50("ngModel",i.pageSize),t.R7$(),t.Y8G("value",10),t.R7$(2),t.Y8G("value",25),t.R7$(2),t.Y8G("value",50),t.R7$(2),t.Y8G("value",100),t.R7$(3),t.Y8G("ngIf",i.isLoading),t.R7$(),t.Y8G("ngIf",!i.isLoading&&0===i.hamlets.length),t.R7$(),t.Y8G("ngIf",!i.isLoading&&i.hamlets.length>0),t.R7$(),t.Y8G("ngIf",!i.isLoading&&i.totalPages>1))},dependencies:[m.MD,m.Sq,m.bT,m.QX,g.iI,g.Wk,r.YN,r.xH,r.y7,r.me,r.wz,r.BC,r.vS],styles:[".container-fluid[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 1rem}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;font-weight:600;color:#495057}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:.25rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:not(:last-child){margin-right:2px}.badge[_ngcontent-%COMP%]{font-size:.75em}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}.sortable[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:5px;font-size:.7em}"]})}}return s})()}}]);