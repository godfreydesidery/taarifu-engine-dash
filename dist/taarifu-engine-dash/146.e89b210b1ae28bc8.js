"use strict";(self.webpackChunktaarifu_engine_dash=self.webpackChunktaarifu_engine_dash||[]).push([[146],{8146:(Z,I,d)=>{d.r(I),d.d(I,{WardFormComponent:()=>Q});var k=d(177),w=d(1069),o=d(4341),e=d(4438),A=d(4486),S=d(3446),T=d(5996);function L(t,a){1&t&&(e.j41(0,"div",54),e.EFF(1," Ward name is required "),e.k0s())}function N(t,a){1&t&&(e.j41(0,"div",54),e.EFF(1," Ward name must not exceed 100 characters "),e.k0s())}function M(t,a){1&t&&(e.j41(0,"div",54),e.EFF(1," Headquarters is required "),e.k0s())}function G(t,a){1&t&&(e.j41(0,"div",54),e.EFF(1," Headquarters must not exceed 100 characters "),e.k0s())}function P(t,a){if(1&t&&(e.j41(0,"option",40),e.EFF(1),e.k0s()),2&t){const r=a.$implicit;e.Y8G("value",r.id),e.R7$(),e.JRh(r.name)}}function y(t,a){1&t&&(e.j41(0,"div",54),e.EFF(1," Region is required "),e.k0s())}function U(t,a){if(1&t&&(e.j41(0,"option",40),e.EFF(1),e.k0s()),2&t){const r=a.$implicit;e.Y8G("value",r.id),e.R7$(),e.JRh(r.name)}}function x(t,a){1&t&&(e.j41(0,"div",54),e.EFF(1," District is required "),e.k0s())}function Y(t,a){1&t&&(e.j41(0,"div",54),e.EFF(1," Population must be a positive number "),e.k0s())}function K(t,a){1&t&&(e.j41(0,"div",54),e.EFF(1," Area must be a positive number "),e.k0s())}function B(t,a){1&t&&(e.j41(0,"div",54),e.EFF(1," Latitude must be between -90 and 90 "),e.k0s())}function V(t,a){1&t&&(e.j41(0,"div",54),e.EFF(1," Longitude must be between -180 and 180 "),e.k0s())}function X(t,a){1&t&&(e.j41(0,"div",54),e.EFF(1," Executive officer name must not exceed 100 characters "),e.k0s())}function H(t,a){1&t&&(e.j41(0,"div",54),e.EFF(1," Description must not exceed 500 characters "),e.k0s())}function J(t,a){1&t&&e.nrm(0,"span",55)}function z(t,a){1&t&&e.nrm(0,"i",56)}let Q=(()=>{class t{constructor(r,n,i,l,s,m){this.fb=r,this.wardService=n,this.districtService=i,this.regionService=l,this.route=s,this.router=m,this.isEditMode=!1,this.isLoading=!1,this.wardId=null,this.regions=[],this.districts=[],this.filteredDistricts=[],this.wardForm=this.fb.group({name:["",[o.k0.required,o.k0.maxLength(100)]],headquarters:["",[o.k0.required,o.k0.maxLength(100)]],regionId:[null,[o.k0.required]],districtId:[null,[o.k0.required]],population:[0,[o.k0.min(0)]],areaSqKm:[0,[o.k0.min(0)]],latitude:[0,[o.k0.min(-90),o.k0.max(90)]],longitude:[0,[o.k0.min(-180),o.k0.max(180)]],executiveOfficer:["",[o.k0.maxLength(100)]],description:["",[o.k0.maxLength(500)]],isActive:[!0]})}ngOnInit(){this.loadRegions(),this.loadDistricts(),this.wardId=this.route.snapshot.paramMap.get("uid"),this.wardId&&(this.isEditMode=!0,this.loadWard(this.wardId))}loadRegions(){this.regionService.getAllRegions(0,1e3).subscribe({next:r=>{this.regions=r.data||[]},error:r=>{console.error("Error loading regions:",r)}})}loadDistricts(){console.log("Loading districts..."),this.districtService.getAllDistricts(0,1e3).subscribe({next:r=>{this.districts=r.data||[],this.filteredDistricts=this.districts,console.log("Loaded districts:",this.districts),console.log("Sample district structure:",this.districts[0])},error:r=>{console.error("Error loading districts:",r)}})}loadWard(r){this.isLoading=!0,console.log("Loading ward with UID:",r),this.wardService.getWardByUid(r).subscribe({next:n=>{if(this.isLoading=!1,console.log("Ward API Response:",n),n.status){const i=n.data;console.log("Ward data:",i),this.wardForm.patchValue({name:i.name,headquarters:i.headquarters,regionId:i.regionId,districtId:i.districtId,population:i.population,areaSqKm:i.areaSqKm,latitude:i.latitude,longitude:i.longitude,executiveOfficer:i.executiveOfficer,description:i.description,isActive:i.isActive}),this.onRegionChange()}},error:n=>{this.isLoading=!1,console.error("Error loading ward:",n),console.error("Error status:",n.status),console.error("Error details:",n.error),alert(`Error loading ward: ${n.error?.message||n.message||"Unknown error"}`),this.goBack()}})}onRegionChange(){const r=this.wardForm.get("regionId")?.value;if(console.log("Region changed to:",r),r){const n=this.regions.find(i=>i.id===Number(r));console.log("Selected region:",n),n&&this.districtService.getDistrictsByRegionUid(n.uid,0,1e3).subscribe({next:i=>{this.filteredDistricts=i.data||[],console.log("Loaded districts for region",n.name,":",this.filteredDistricts);const l=this.wardForm.get("districtId")?.value;l&&!this.filteredDistricts.find(s=>s.id===l)&&this.wardForm.patchValue({districtId:null})},error:i=>{console.error("Error loading districts for region:",i),this.filteredDistricts=[]}})}else this.filteredDistricts=this.districts,console.log("No region selected, showing all districts:",this.filteredDistricts)}onSubmit(){if(this.wardForm.valid){this.isLoading=!0;const r=this.wardForm.value;this.isEditMode&&this.wardId?this.wardService.updateWard(this.wardId,{name:r.name,headquarters:r.headquarters,districtId:r.districtId,population:r.population,areaSqKm:r.areaSqKm,latitude:r.latitude,longitude:r.longitude,executiveOfficer:r.executiveOfficer,description:r.description,isActive:r.isActive}).subscribe({next:i=>{this.isLoading=!1,i.status&&(alert("Ward updated successfully!"),this.goBack())},error:i=>{this.isLoading=!1,console.error("Error updating ward:",i),alert(`Error updating ward: ${i.error?.message||i.message||"Unknown error"}`)}}):this.wardService.createWard({name:r.name,headquarters:r.headquarters,districtId:r.districtId,population:r.population,areaSqKm:r.areaSqKm,latitude:r.latitude,longitude:r.longitude,executiveOfficer:r.executiveOfficer,description:r.description,isActive:r.isActive}).subscribe({next:i=>{this.isLoading=!1,i.status&&(alert("Ward created successfully!"),this.goBack())},error:i=>{this.isLoading=!1,console.error("Error creating ward:",i),alert(`Error creating ward: ${i.error?.message||i.message||"Unknown error"}`)}})}else Object.keys(this.wardForm.controls).forEach(r=>{this.wardForm.get(r)?.markAsTouched()})}goBack(){this.router.navigate(["/wards"])}static{this.\u0275fac=function(n){return new(n||t)(e.rXU(o.ok),e.rXU(A.U),e.rXU(S.m),e.rXU(T.S),e.rXU(w.nX),e.rXU(w.Ix))}}static{this.\u0275cmp=e.VBU({type:t,selectors:[["app-ward-form"]],standalone:!0,features:[e.aNF],decls:144,vars:43,consts:[[1,"ward-form-container"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"h3","mb-1"],[1,"text-muted"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-arrow-left","me-1"],[1,"row"],[1,"col-lg-8"],[1,"card"],[1,"card-header"],[1,"card-title","mb-0"],[1,"bi","bi-house","me-2"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"row","g-3"],[1,"col-md-6"],["for","name",1,"form-label"],[1,"text-danger"],["type","text","id","name","formControlName","name","placeholder","Enter ward name",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","headquarters",1,"form-label"],["type","text","id","headquarters","formControlName","headquarters","placeholder","Enter headquarters",1,"form-control"],["for","regionId",1,"form-label"],["id","regionId","formControlName","regionId",1,"form-select",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","districtId",1,"form-label"],["id","districtId","formControlName","districtId",1,"form-select"],["for","population",1,"form-label"],["type","number","id","population","formControlName","population","placeholder","Enter population","min","0",1,"form-control"],["for","areaSqKm",1,"form-label"],["type","number","id","areaSqKm","formControlName","areaSqKm","placeholder","Enter area in square kilometers","min","0","step","0.1",1,"form-control"],["for","latitude",1,"form-label"],["type","number","id","latitude","formControlName","latitude","placeholder","Enter latitude","step","0.000001",1,"form-control"],["for","longitude",1,"form-label"],["type","number","id","longitude","formControlName","longitude","placeholder","Enter longitude","step","0.000001",1,"form-control"],["for","executiveOfficer",1,"form-label"],["type","text","id","executiveOfficer","formControlName","executiveOfficer","placeholder","Enter executive officer name",1,"form-control"],["for","isActive",1,"form-label"],["id","isActive","formControlName","isActive",1,"form-select"],[3,"value"],[1,"col-12"],["for","description",1,"form-label"],["id","description","formControlName","description","rows","3","placeholder","Enter ward description",1,"form-control"],[1,"row","mt-4"],[1,"d-flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-2","role","status",4,"ngIf"],["class","bi bi-check-circle me-1",4,"ngIf"],[1,"bi","bi-x-circle","me-1"],[1,"col-lg-4"],[1,"bi","bi-info-circle","me-2"],[1,"list-unstyled","small","text-muted"],[1,"mt-3"],[1,"invalid-feedback"],["role","status",1,"spinner-border","spinner-border-sm","me-2"],[1,"bi","bi-check-circle","me-1"]],template:function(n,i){if(1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),e.EFF(4),e.k0s(),e.j41(5,"p",3),e.EFF(6),e.k0s()(),e.j41(7,"button",4),e.bIt("click",function(){return i.goBack()}),e.nrm(8,"i",5),e.EFF(9," Back to Wards "),e.k0s()(),e.j41(10,"div",6)(11,"div",7)(12,"div",8)(13,"div",9)(14,"h5",10),e.nrm(15,"i",11),e.EFF(16," Ward Information "),e.k0s()(),e.j41(17,"div",12)(18,"form",13),e.bIt("ngSubmit",function(){return i.onSubmit()}),e.j41(19,"div",14)(20,"div",15)(21,"label",16),e.EFF(22,"Ward Name "),e.j41(23,"span",17),e.EFF(24,"*"),e.k0s()(),e.nrm(25,"input",18),e.DNE(26,L,2,0,"div",19)(27,N,2,0,"div",19),e.k0s(),e.j41(28,"div",15)(29,"label",20),e.EFF(30,"Headquarters "),e.j41(31,"span",17),e.EFF(32,"*"),e.k0s()(),e.nrm(33,"input",21),e.DNE(34,M,2,0,"div",19)(35,G,2,0,"div",19),e.k0s(),e.j41(36,"div",15)(37,"label",22),e.EFF(38,"Region "),e.j41(39,"span",17),e.EFF(40,"*"),e.k0s()(),e.j41(41,"select",23),e.bIt("change",function(){return i.onRegionChange()}),e.j41(42,"option",24),e.EFF(43,"Select a region"),e.k0s(),e.DNE(44,P,2,2,"option",25),e.k0s(),e.DNE(45,y,2,0,"div",19),e.k0s(),e.j41(46,"div",15)(47,"label",26),e.EFF(48,"District "),e.j41(49,"span",17),e.EFF(50,"*"),e.k0s()(),e.j41(51,"select",27)(52,"option",24),e.EFF(53,"Select a district"),e.k0s(),e.DNE(54,U,2,2,"option",25),e.k0s(),e.DNE(55,x,2,0,"div",19),e.k0s(),e.j41(56,"div",15)(57,"label",28),e.EFF(58,"Population"),e.k0s(),e.nrm(59,"input",29),e.DNE(60,Y,2,0,"div",19),e.k0s(),e.j41(61,"div",15)(62,"label",30),e.EFF(63,"Area (km\xb2)"),e.k0s(),e.nrm(64,"input",31),e.DNE(65,K,2,0,"div",19),e.k0s(),e.j41(66,"div",15)(67,"label",32),e.EFF(68,"Latitude"),e.k0s(),e.nrm(69,"input",33),e.DNE(70,B,2,0,"div",19),e.k0s(),e.j41(71,"div",15)(72,"label",34),e.EFF(73,"Longitude"),e.k0s(),e.nrm(74,"input",35),e.DNE(75,V,2,0,"div",19),e.k0s(),e.j41(76,"div",15)(77,"label",36),e.EFF(78,"Executive Officer"),e.k0s(),e.nrm(79,"input",37),e.DNE(80,X,2,0,"div",19),e.k0s(),e.j41(81,"div",15)(82,"label",38),e.EFF(83,"Status"),e.k0s(),e.j41(84,"select",39)(85,"option",40),e.EFF(86,"Active"),e.k0s(),e.j41(87,"option",40),e.EFF(88,"Inactive"),e.k0s()()(),e.j41(89,"div",41)(90,"label",42),e.EFF(91,"Description"),e.k0s(),e.nrm(92,"textarea",43),e.DNE(93,H,2,0,"div",19),e.k0s()(),e.j41(94,"div",44)(95,"div",41)(96,"div",45)(97,"button",46),e.DNE(98,J,1,0,"span",47)(99,z,1,0,"i",48),e.EFF(100),e.k0s(),e.j41(101,"button",4),e.bIt("click",function(){return i.goBack()}),e.nrm(102,"i",49),e.EFF(103," Cancel "),e.k0s()()()()()()()(),e.j41(104,"div",50)(105,"div",8)(106,"div",9)(107,"h6",10),e.nrm(108,"i",51),e.EFF(109," Help & Guidelines "),e.k0s()(),e.j41(110,"div",12)(111,"h6"),e.EFF(112,"Required Fields"),e.k0s(),e.j41(113,"ul",52)(114,"li"),e.EFF(115,"\u2022 Ward Name"),e.k0s(),e.j41(116,"li"),e.EFF(117,"\u2022 Headquarters"),e.k0s(),e.j41(118,"li"),e.EFF(119,"\u2022 Region"),e.k0s(),e.j41(120,"li"),e.EFF(121,"\u2022 District"),e.k0s()(),e.j41(122,"h6",53),e.EFF(123,"Optional Fields"),e.k0s(),e.j41(124,"ul",52)(125,"li"),e.EFF(126,"\u2022 Population"),e.k0s(),e.j41(127,"li"),e.EFF(128,"\u2022 Area (km\xb2)"),e.k0s(),e.j41(129,"li"),e.EFF(130,"\u2022 Coordinates"),e.k0s(),e.j41(131,"li"),e.EFF(132,"\u2022 Executive Officer"),e.k0s(),e.j41(133,"li"),e.EFF(134,"\u2022 Description"),e.k0s()(),e.j41(135,"h6",53),e.EFF(136,"Tips"),e.k0s(),e.j41(137,"ul",52)(138,"li"),e.EFF(139,"\u2022 Select region first to filter districts"),e.k0s(),e.j41(140,"li"),e.EFF(141,"\u2022 Use precise coordinates for mapping"),e.k0s(),e.j41(142,"li"),e.EFF(143,"\u2022 Keep descriptions concise and informative"),e.k0s()()()()()()()),2&n){let l,s,m,u,R,j,c,C,g,D,f,W,p,q,F,h,v,_,E,O,b,$;e.R7$(4),e.JRh(i.isEditMode?"Edit Ward":"Create New Ward"),e.R7$(2),e.JRh(i.isEditMode?"Update ward information":"Add a new ward to the system"),e.R7$(12),e.Y8G("formGroup",i.wardForm),e.R7$(7),e.AVh("is-invalid",(null==(l=i.wardForm.get("name"))?null:l.invalid)&&(null==(l=i.wardForm.get("name"))?null:l.touched)),e.R7$(),e.Y8G("ngIf",null==(s=i.wardForm.get("name"))?null:s.hasError("required")),e.R7$(),e.Y8G("ngIf",null==(m=i.wardForm.get("name"))?null:m.hasError("maxlength")),e.R7$(6),e.AVh("is-invalid",(null==(u=i.wardForm.get("headquarters"))?null:u.invalid)&&(null==(u=i.wardForm.get("headquarters"))?null:u.touched)),e.R7$(),e.Y8G("ngIf",null==(R=i.wardForm.get("headquarters"))?null:R.hasError("required")),e.R7$(),e.Y8G("ngIf",null==(j=i.wardForm.get("headquarters"))?null:j.hasError("maxlength")),e.R7$(6),e.AVh("is-invalid",(null==(c=i.wardForm.get("regionId"))?null:c.invalid)&&(null==(c=i.wardForm.get("regionId"))?null:c.touched)),e.R7$(3),e.Y8G("ngForOf",i.regions),e.R7$(),e.Y8G("ngIf",null==(C=i.wardForm.get("regionId"))?null:C.hasError("required")),e.R7$(6),e.AVh("is-invalid",(null==(g=i.wardForm.get("districtId"))?null:g.invalid)&&(null==(g=i.wardForm.get("districtId"))?null:g.touched)),e.R7$(3),e.Y8G("ngForOf",i.filteredDistricts),e.R7$(),e.Y8G("ngIf",null==(D=i.wardForm.get("districtId"))?null:D.hasError("required")),e.R7$(4),e.AVh("is-invalid",(null==(f=i.wardForm.get("population"))?null:f.invalid)&&(null==(f=i.wardForm.get("population"))?null:f.touched)),e.R7$(),e.Y8G("ngIf",null==(W=i.wardForm.get("population"))?null:W.hasError("min")),e.R7$(4),e.AVh("is-invalid",(null==(p=i.wardForm.get("areaSqKm"))?null:p.invalid)&&(null==(p=i.wardForm.get("areaSqKm"))?null:p.touched)),e.R7$(),e.Y8G("ngIf",null==(q=i.wardForm.get("areaSqKm"))?null:q.hasError("min")),e.R7$(4),e.AVh("is-invalid",(null==(F=i.wardForm.get("latitude"))?null:F.invalid)&&(null==(F=i.wardForm.get("latitude"))?null:F.touched)),e.R7$(),e.Y8G("ngIf",(null==(h=i.wardForm.get("latitude"))?null:h.hasError("min"))||(null==(h=i.wardForm.get("latitude"))?null:h.hasError("max"))),e.R7$(4),e.AVh("is-invalid",(null==(v=i.wardForm.get("longitude"))?null:v.invalid)&&(null==(v=i.wardForm.get("longitude"))?null:v.touched)),e.R7$(),e.Y8G("ngIf",(null==(_=i.wardForm.get("longitude"))?null:_.hasError("min"))||(null==(_=i.wardForm.get("longitude"))?null:_.hasError("max"))),e.R7$(4),e.AVh("is-invalid",(null==(E=i.wardForm.get("executiveOfficer"))?null:E.invalid)&&(null==(E=i.wardForm.get("executiveOfficer"))?null:E.touched)),e.R7$(),e.Y8G("ngIf",null==(O=i.wardForm.get("executiveOfficer"))?null:O.hasError("maxlength")),e.R7$(5),e.Y8G("value",!0),e.R7$(2),e.Y8G("value",!1),e.R7$(5),e.AVh("is-invalid",(null==(b=i.wardForm.get("description"))?null:b.invalid)&&(null==(b=i.wardForm.get("description"))?null:b.touched)),e.R7$(),e.Y8G("ngIf",null==($=i.wardForm.get("description"))?null:$.hasError("maxlength")),e.R7$(4),e.Y8G("disabled",i.wardForm.invalid||i.isLoading),e.R7$(),e.Y8G("ngIf",i.isLoading),e.R7$(),e.Y8G("ngIf",!i.isLoading),e.R7$(),e.SpI(" ",i.isEditMode?"Update Ward":"Create Ward"," ")}},dependencies:[k.MD,k.Sq,k.bT,w.iI,o.X1,o.qT,o.xH,o.y7,o.me,o.Q0,o.wz,o.BC,o.cb,o.VZ,o.j4,o.JD],styles:[".ward-form-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 1rem}.card[_ngcontent-%COMP%]{border:none;box-shadow:0 .125rem .25rem #00000013}.card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid #dee2e6}.form-label[_ngcontent-%COMP%]{font-weight:500;color:#495057}.text-danger[_ngcontent-%COMP%]{color:#dc3545!important}.btn[_ngcontent-%COMP%]{font-weight:500}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem}"]})}}return t})()}}]);