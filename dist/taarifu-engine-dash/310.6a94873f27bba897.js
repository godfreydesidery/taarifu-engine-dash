"use strict";(self.webpackChunktaarifu_engine_dash=self.webpackChunktaarifu_engine_dash||[]).push([[310],{3310:(P,u,o)=>{o.r(u),o.d(u,{WardListComponent:()=>E});var l=o(177),g=o(1069),c=o(4341),e=o(4438),h=o(4486),_=o(8010);const m=i=>["/wards/edit",i];function p(i,d){1&i&&(e.j41(0,"div",26)(1,"div",27)(2,"span",28),e.EFF(3,"Loading..."),e.k0s()(),e.j41(4,"p",29),e.EFF(5,"Loading wards..."),e.k0s()())}function b(i,d){1&i&&(e.j41(0,"div",30),e.nrm(1,"i",31),e.j41(2,"h4",32),e.EFF(3,"No wards found"),e.k0s(),e.j41(4,"p",3),e.EFF(5,"Start by creating your first ward."),e.k0s(),e.j41(6,"a",4),e.nrm(7,"i",5),e.EFF(8," Add Ward "),e.k0s()())}function f(i,d){if(1&i){const t=e.RV6();e.j41(0,"tr")(1,"td")(2,"span",39),e.EFF(3),e.k0s()(),e.j41(4,"td")(5,"div")(6,"strong"),e.EFF(7),e.k0s(),e.nrm(8,"br"),e.j41(9,"small",3),e.EFF(10),e.k0s()()(),e.j41(11,"td"),e.EFF(12),e.k0s(),e.j41(13,"td")(14,"span",40),e.EFF(15),e.k0s()(),e.j41(16,"td")(17,"span",41),e.EFF(18),e.k0s()(),e.j41(19,"td"),e.EFF(20),e.nI1(21,"number"),e.k0s(),e.j41(22,"td"),e.EFF(23),e.nI1(24,"number"),e.k0s(),e.j41(25,"td")(26,"span",42),e.EFF(27),e.k0s()(),e.j41(28,"td")(29,"div",43)(30,"a",44),e.nrm(31,"i",45),e.k0s(),e.j41(32,"button",46),e.bIt("click",function(){const r=e.eBV(t).$implicit,s=e.XpG(2);return e.Njj(s.onDelete(r))}),e.nrm(33,"i",47),e.k0s()()()()}if(2&i){const t=d.$implicit;e.R7$(3),e.JRh(t.code),e.R7$(4),e.JRh(t.name),e.R7$(3),e.JRh(t.executiveOfficer),e.R7$(2),e.JRh(t.headquarters),e.R7$(3),e.JRh(t.districtName),e.R7$(3),e.JRh(t.regionName),e.R7$(2),e.JRh(e.bMT(21,14,t.population)),e.R7$(3),e.JRh(e.i5U(24,16,t.areaSqKm,"1.1-1")),e.R7$(3),e.AVh("bg-success",t.isActive)("bg-danger",!t.isActive),e.R7$(),e.SpI(" ",t.isActive?"Active":"Inactive"," "),e.R7$(3),e.Y8G("routerLink",e.eq3(19,m,t.uid))}}function v(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",33)(1,"table",34)(2,"thead",35)(3,"tr")(4,"th",36),e.bIt("click",function(r){e.eBV(t);const s=e.XpG();return e.Njj(s.onSort("code",r))}),e.EFF(5," Code "),e.nrm(6,"i",37),e.k0s(),e.j41(7,"th",36),e.bIt("click",function(r){e.eBV(t);const s=e.XpG();return e.Njj(s.onSort("name",r))}),e.EFF(8," Name "),e.nrm(9,"i",37),e.k0s(),e.j41(10,"th"),e.EFF(11,"Headquarters"),e.k0s(),e.j41(12,"th"),e.EFF(13,"District"),e.k0s(),e.j41(14,"th"),e.EFF(15,"Region"),e.k0s(),e.j41(16,"th"),e.EFF(17,"Population"),e.k0s(),e.j41(18,"th"),e.EFF(19,"Area (km\xb2)"),e.k0s(),e.j41(20,"th"),e.EFF(21,"Status"),e.k0s(),e.j41(22,"th"),e.EFF(23,"Actions"),e.k0s()()(),e.j41(24,"tbody"),e.DNE(25,f,34,21,"tr",38),e.k0s()()()}if(2&i){const t=e.XpG();e.R7$(6),e.AVh("bi-arrow-up","code"===t.sortBy&&"asc"===t.sortDir)("bi-arrow-down","code"===t.sortBy&&"desc"===t.sortDir),e.R7$(3),e.AVh("bi-arrow-up","name"===t.sortBy&&"asc"===t.sortDir)("bi-arrow-down","name"===t.sortBy&&"desc"===t.sortDir),e.R7$(16),e.Y8G("ngForOf",t.wards)}}function F(i,d){if(1&i){const t=e.RV6();e.j41(0,"li",51)(1,"a",52),e.bIt("click",function(r){const s=e.eBV(t).$implicit,a=e.XpG(2);return e.Njj(a.onPageChange(s,r))}),e.EFF(2),e.k0s()()}if(2&i){const t=d.$implicit,n=e.XpG(2);e.AVh("active",t===n.currentPage),e.R7$(2),e.JRh(t+1)}}function k(i,d){if(1&i){const t=e.RV6();e.j41(0,"div",48)(1,"nav",49)(2,"ul",50)(3,"li",51)(4,"a",52),e.bIt("click",function(r){e.eBV(t);const s=e.XpG();return e.Njj(s.onPageChange(s.currentPage-1,r))}),e.EFF(5,"Previous"),e.k0s()(),e.DNE(6,F,3,3,"li",53),e.j41(7,"li",51)(8,"a",52),e.bIt("click",function(r){e.eBV(t);const s=e.XpG();return e.Njj(s.onPageChange(s.currentPage+1,r))}),e.EFF(9,"Next"),e.k0s()()()()()}if(2&i){const t=e.XpG();e.R7$(3),e.AVh("disabled",0===t.currentPage),e.R7$(3),e.Y8G("ngForOf",t.getPageNumbers()),e.R7$(),e.AVh("disabled",t.currentPage===t.totalPages-1)}}let E=(()=>{class i{constructor(t,n,r){this.wardService=t,this.authService=n,this.router=r,this.wards=[],this.searchTerm="",this.currentPage=0,this.pageSize=10,this.totalElements=0,this.totalPages=0,this.sortBy="name",this.sortDir="asc",this.isLoading=!1}ngOnInit(){console.log("WardListComponent initialized");const t=this.authService.getToken(),n=this.authService.isAuthenticated(),r=this.authService.getCurrentUser();if(console.log("Auth Debug Info:"),console.log("- Token exists:",!!t),console.log("- Token value:",t?t.substring(0,50)+"...":"No token"),console.log("- Is authenticated:",n),console.log("- Current user:",r),!n)return console.error("User not authenticated! Redirecting to login..."),void this.router.navigate(["/login"]);this.loadWards()}loadWards(){this.isLoading=!0,(this.searchTerm?this.wardService.searchWards(this.searchTerm,this.currentPage,this.pageSize,this.sortBy,this.sortDir):this.wardService.getAllWards(this.currentPage,this.pageSize,this.sortBy,this.sortDir)).subscribe({next:n=>{this.isLoading=!1,console.log("Wards API Response:",n),this.wards=n.data||[],this.totalElements=n.totalElements||0,this.totalPages=n.totalPages||0,console.log("Loaded wards:",this.wards.length)},error:n=>{this.isLoading=!1,console.error("Error loading wards:",n),console.error("Error status:",n.status),console.error("Error details:",n.error),403===n.status?(console.error("403 Forbidden - Authentication/Authorization issue"),console.error("Current token:",this.authService.getToken()),alert("Access denied. Please log in again."),this.authService.logout(),this.router.navigate(["/login"])):401===n.status?(console.error("401 Unauthorized - Token expired or invalid"),alert("Session expired. Please log in again."),this.authService.logout(),this.router.navigate(["/login"])):alert(`Error loading wards: ${n.error?.message||n.message||"Unknown error"}`)}})}onSearch(){this.currentPage=0,this.loadWards()}onSort(t,n){n.preventDefault(),this.sortBy===t?this.sortDir="asc"===this.sortDir?"desc":"asc":(this.sortBy=t,this.sortDir="asc"),this.currentPage=0,this.loadWards()}onPageChange(t,n){n.preventDefault(),t>=0&&t<this.totalPages&&(this.currentPage=t,this.loadWards())}onPageSizeChange(){this.currentPage=0,this.loadWards()}onDelete(t){confirm(`Are you sure you want to delete the ward "${t.name}"?`)&&this.wardService.deleteWard(t.uid).subscribe({next:n=>{n.status&&(alert("Ward deleted successfully!"),this.loadWards())},error:n=>{console.error("Error deleting ward:",n),alert(`Error deleting ward: ${n.error?.message||n.message||"Unknown error"}`)}})}getPageNumbers(){const t=[],n=Math.max(0,this.currentPage-2),r=Math.min(this.totalPages-1,this.currentPage+2);for(let s=n;s<=r;s++)t.push(s);return t}static{this.\u0275fac=function(n){return new(n||i)(e.rXU(h.U),e.rXU(_.u),e.rXU(g.Ix))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-ward-list"]],standalone:!0,features:[e.aNF],decls:40,vars:10,consts:[[1,"ward-list-container"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"h3","mb-1"],[1,"text-muted"],["routerLink","/wards/create",1,"btn","btn-primary"],[1,"bi","bi-plus-circle","me-1"],[1,"card","mb-4"],[1,"card-body"],[1,"row"],[1,"col-md-6"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-search"],["type","text","placeholder","Search wards...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],[1,"card"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"card-title","mb-0"],[1,"bi","bi-house","me-2"],[1,"d-flex","align-items-center"],[1,"text-muted","me-2"],[1,"form-select","form-select-sm","w-auto",3,"ngModelChange","change","ngModel"],[3,"value"],["class","text-center py-4",4,"ngIf"],["class","text-center py-5",4,"ngIf"],["class","table-responsive",4,"ngIf"],["class","card-footer",4,"ngIf"],[1,"text-center","py-4"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],[1,"text-center","py-5"],[1,"bi","bi-house","text-muted",2,"font-size","3rem"],[1,"text-muted","mt-3"],[1,"table-responsive"],[1,"table","table-hover"],[1,"table-light"],[1,"sortable",3,"click"],[1,"bi"],[4,"ngFor","ngForOf"],[1,"badge","bg-primary"],[1,"badge","bg-warning","text-dark"],[1,"badge","bg-success"],[1,"badge"],["role","group",1,"btn-group","btn-group-sm"],["title","Edit",1,"btn","btn-outline-primary",3,"routerLink"],[1,"bi","bi-pencil"],["title","Delete",1,"btn","btn-outline-danger",3,"click"],[1,"bi","bi-trash"],[1,"card-footer"],["aria-label","Wards pagination"],[1,"pagination","pagination-sm","justify-content-center","mb-0"],[1,"page-item"],["href","#",1,"page-link",3,"click"],["class","page-item",3,"active",4,"ngFor","ngForOf"]],template:function(n,r){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),e.EFF(4,"Wards Management"),e.k0s(),e.j41(5,"p",3),e.EFF(6,"Manage all wards in the system"),e.k0s()(),e.j41(7,"a",4),e.nrm(8,"i",5),e.EFF(9," Add New Ward "),e.k0s()(),e.j41(10,"div",6)(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10)(15,"span",11),e.nrm(16,"i",12),e.k0s(),e.j41(17,"input",13),e.mxI("ngModelChange",function(a){return e.DH7(r.searchTerm,a)||(r.searchTerm=a),a}),e.bIt("keyup.enter",function(){return r.onSearch()}),e.k0s()()()()()(),e.j41(18,"div",14)(19,"div",15)(20,"h5",16),e.nrm(21,"i",17),e.EFF(22," All Wards "),e.k0s(),e.j41(23,"div",18)(24,"span",19),e.EFF(25,"Page Size:"),e.k0s(),e.j41(26,"select",20),e.mxI("ngModelChange",function(a){return e.DH7(r.pageSize,a)||(r.pageSize=a),a}),e.bIt("change",function(){return r.onPageSizeChange()}),e.j41(27,"option",21),e.EFF(28,"10"),e.k0s(),e.j41(29,"option",21),e.EFF(30,"25"),e.k0s(),e.j41(31,"option",21),e.EFF(32,"50"),e.k0s(),e.j41(33,"option",21),e.EFF(34,"100"),e.k0s()()()(),e.j41(35,"div",7),e.DNE(36,p,6,0,"div",22)(37,b,9,0,"div",23)(38,v,26,9,"div",24),e.k0s(),e.DNE(39,k,10,5,"div",25),e.k0s()()),2&n&&(e.R7$(17),e.R50("ngModel",r.searchTerm),e.R7$(9),e.R50("ngModel",r.pageSize),e.R7$(),e.Y8G("value",10),e.R7$(2),e.Y8G("value",25),e.R7$(2),e.Y8G("value",50),e.R7$(2),e.Y8G("value",100),e.R7$(3),e.Y8G("ngIf",r.isLoading),e.R7$(),e.Y8G("ngIf",!r.isLoading&&0===r.wards.length),e.R7$(),e.Y8G("ngIf",!r.isLoading&&r.wards.length>0),e.R7$(),e.Y8G("ngIf",!r.isLoading&&r.totalPages>1))},dependencies:[l.MD,l.Sq,l.bT,l.QX,g.iI,g.Wk,c.YN,c.xH,c.y7,c.me,c.wz,c.BC,c.vS],styles:[".ward-list-container[_ngcontent-%COMP%]{max-width:1400px;margin:0 auto;padding:0 1rem}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;font-weight:600;color:#495057}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{vertical-align:middle}.badge[_ngcontent-%COMP%]{font-size:.75rem}.btn-group-sm[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{padding:.25rem .5rem}.pagination[_ngcontent-%COMP%]{margin-bottom:0}.card[_ngcontent-%COMP%]{border:none;box-shadow:0 .125rem .25rem #00000013}.card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid #dee2e6}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}.sortable[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:5px;font-size:.7em}"]})}}return i})()}}]);