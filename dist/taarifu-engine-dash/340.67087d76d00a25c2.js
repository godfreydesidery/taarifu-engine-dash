"use strict";(self.webpackChunktaarifu_engine_dash=self.webpackChunktaarifu_engine_dash||[]).push([[340],{7340:(E,d,r)=>{r.r(d),r.d(d,{RegionListComponent:()=>F});var l=r(177),u=r(1069),a=r(4341),e=r(4438),_=r(5996),h=r(8010),p=r(5423);function m(s,c){1&s&&(e.j41(0,"div",26)(1,"div",27)(2,"span",28),e.EFF(3,"Loading..."),e.k0s()(),e.j41(4,"p",29),e.EFF(5,"Loading regions..."),e.k0s()())}function b(s,c){1&s&&(e.j41(0,"div",30),e.nrm(1,"i",31),e.j41(2,"h4",32),e.EFF(3,"No regions found"),e.k0s(),e.j41(4,"p",3),e.EFF(5,"Start by creating your first region."),e.k0s(),e.j41(6,"a",4),e.nrm(7,"i",5),e.EFF(8," Add Region "),e.k0s()())}function R(s,c){if(1&s){const t=e.RV6();e.j41(0,"tr")(1,"td")(2,"span",39),e.EFF(3),e.k0s()(),e.j41(4,"td")(5,"strong"),e.EFF(6),e.k0s()(),e.j41(7,"td"),e.EFF(8),e.k0s(),e.j41(9,"td"),e.EFF(10),e.nI1(11,"number"),e.k0s(),e.j41(12,"td"),e.EFF(13),e.nI1(14,"number"),e.k0s(),e.j41(15,"td"),e.EFF(16),e.k0s(),e.j41(17,"td")(18,"span",40),e.EFF(19),e.k0s()(),e.j41(20,"td")(21,"div",41)(22,"button",42),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.editRegion(i))}),e.nrm(23,"i",43),e.k0s(),e.j41(24,"button",44),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.toggleStatus(i))}),e.nrm(25,"i",37),e.k0s(),e.j41(26,"button",45),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.deleteRegion(i))}),e.nrm(27,"i",46),e.k0s()()()()}if(2&s){const t=c.$implicit;e.R7$(3),e.JRh(t.code),e.R7$(3),e.JRh(t.name),e.R7$(2),e.JRh(t.capital),e.R7$(2),e.JRh(e.bMT(11,15,t.population)),e.R7$(3),e.JRh(e.i5U(14,17,t.areaSqKm,"1.2-2")),e.R7$(3),e.JRh(t.commissioner||"Not specified"),e.R7$(2),e.AVh("bg-success",t.isActive)("bg-secondary",!t.isActive),e.R7$(),e.SpI(" ",t.isActive?"Active":"Inactive"," "),e.R7$(6),e.AVh("bi-pause",t.isActive)("bi-play",!t.isActive)}}function v(s,c){if(1&s){const t=e.RV6();e.j41(0,"div",33)(1,"table",34)(2,"thead",35)(3,"tr")(4,"th",36),e.bIt("click",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.onSort("code",i))}),e.EFF(5," Code "),e.nrm(6,"i",37),e.k0s(),e.j41(7,"th",36),e.bIt("click",function(i){e.eBV(t);const o=e.XpG();return e.Njj(o.onSort("name",i))}),e.EFF(8," Name "),e.nrm(9,"i",37),e.k0s(),e.j41(10,"th"),e.EFF(11,"Capital"),e.k0s(),e.j41(12,"th"),e.EFF(13,"Population"),e.k0s(),e.j41(14,"th"),e.EFF(15,"Area (km\xb2)"),e.k0s(),e.j41(16,"th"),e.EFF(17,"Commissioner"),e.k0s(),e.j41(18,"th"),e.EFF(19,"Status"),e.k0s(),e.j41(20,"th"),e.EFF(21,"Actions"),e.k0s()()(),e.j41(22,"tbody"),e.DNE(23,R,28,20,"tr",38),e.k0s()()()}if(2&s){const t=e.XpG();e.R7$(6),e.AVh("bi-arrow-up","code"===t.sortBy&&"asc"===t.sortDir)("bi-arrow-down","code"===t.sortBy&&"desc"===t.sortDir),e.R7$(3),e.AVh("bi-arrow-up","name"===t.sortBy&&"asc"===t.sortDir)("bi-arrow-down","name"===t.sortBy&&"desc"===t.sortDir),e.R7$(14),e.Y8G("ngForOf",t.regions)}}function f(s,c){if(1&s){const t=e.RV6();e.j41(0,"li",49)(1,"button",52),e.bIt("click",function(){const i=e.eBV(t).$implicit,o=e.XpG(2);return e.Njj(o.goToPage(i))}),e.EFF(2),e.k0s()()}if(2&s){const t=c.$implicit,n=e.XpG(2);e.AVh("active",t===n.currentPage),e.R7$(2),e.JRh(t+1)}}function k(s,c){if(1&s){const t=e.RV6();e.j41(0,"nav",47)(1,"ul",48)(2,"li",49)(3,"button",50),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.goToPage(i.currentPage-1))}),e.EFF(4,"Previous"),e.k0s()(),e.DNE(5,f,3,3,"li",51),e.j41(6,"li",49)(7,"button",50),e.bIt("click",function(){e.eBV(t);const i=e.XpG();return e.Njj(i.goToPage(i.currentPage+1))}),e.EFF(8,"Next"),e.k0s()()()()}if(2&s){const t=e.XpG();e.R7$(2),e.AVh("disabled",0===t.currentPage),e.R7$(),e.Y8G("disabled",0===t.currentPage),e.R7$(2),e.Y8G("ngForOf",t.getPageNumbers()),e.R7$(),e.AVh("disabled",t.currentPage===t.totalPages-1),e.R7$(),e.Y8G("disabled",t.currentPage===t.totalPages-1)}}let F=(()=>{class s{constructor(t,n,i,o){this.regionService=t,this.authService=n,this.router=i,this.toastService=o,this.regions=[],this.searchTerm="",this.isLoading=!1,this.currentPage=0,this.pageSize=10,this.totalPages=0,this.totalElements=0,this.sortBy="name",this.sortDir="asc"}ngOnInit(){console.log("RegionListComponent initialized");const t=this.authService.getToken(),n=this.authService.isAuthenticated(),i=this.authService.getCurrentUser();if(console.log("Auth Debug Info:"),console.log("- Token exists:",!!t),console.log("- Token value:",t?t.substring(0,50)+"...":"No token"),console.log("- Is authenticated:",n),console.log("- Current user:",i),!n)return console.error("User not authenticated! Redirecting to login..."),void this.router.navigate(["/login"]);this.loadRegions()}loadRegions(){this.isLoading=!0,(this.searchTerm?this.regionService.searchRegions(this.searchTerm,this.currentPage,this.pageSize,this.sortBy,this.sortDir):this.regionService.getAllRegions(this.currentPage,this.pageSize,this.sortBy,this.sortDir)).subscribe({next:n=>{this.isLoading=!1,console.log("Regions API Response:",n),this.regions=n.data||[],this.totalElements=n.totalElements||0,this.totalPages=n.totalPages||0,console.log("Loaded regions:",this.regions.length)},error:n=>{this.isLoading=!1,console.error("Error loading regions:",n),console.error("Error status:",n.status),console.error("Error details:",n.error),403===n.status?(console.error("403 Forbidden - Authentication/Authorization issue"),console.error("Current token:",this.authService.getToken()),this.toastService.error("Access Denied","Please log in again."),this.authService.logout(),this.router.navigate(["/login"])):401===n.status?(console.error("401 Unauthorized - Token expired or invalid"),this.toastService.error("Session Expired","Please log in again."),this.authService.logout(),this.router.navigate(["/login"])):this.toastService.error("Error Loading Regions",n.error?.message||n.message||"Unknown error occurred")}})}onSearch(){this.currentPage=0,this.loadRegions()}onPageSizeChange(){this.currentPage=0,this.loadRegions()}onSort(t,n){n.preventDefault(),this.sortBy===t?this.sortDir="asc"===this.sortDir?"desc":"asc":(this.sortBy=t,this.sortDir="asc"),this.currentPage=0,this.loadRegions()}goToPage(t){t>=0&&t<this.totalPages&&(this.currentPage=t,this.loadRegions())}getPageNumbers(){const t=[],n=Math.max(0,this.currentPage-2),i=Math.min(this.totalPages-1,this.currentPage+2);for(let o=n;o<=i;o++)t.push(o);return t}editRegion(t){window.location.href=`/regions/edit/${t.uid}`}toggleStatus(t){this.regionService.toggleRegionStatus(t.uid).subscribe({next:n=>{n.success&&(this.toastService.success("Region Updated",`Region ${n.data.isActive?"activated":"deactivated"} successfully`),this.loadRegions())},error:n=>{console.error("Error toggling region status:",n),this.toastService.error("Error Updating Region","Failed to update region status")}})}deleteRegion(t){confirm(`Are you sure you want to delete region "${t.name}"?`)&&this.regionService.deleteRegion(t.uid).subscribe({next:n=>{n.success&&(this.toastService.success("Region Deleted","Region deleted successfully"),this.loadRegions())},error:n=>{console.error("Error deleting region:",n),this.toastService.error("Error Deleting Region","Failed to delete region")}})}static{this.\u0275fac=function(n){return new(n||s)(e.rXU(_.S),e.rXU(h.u),e.rXU(u.Ix),e.rXU(p.f))}}static{this.\u0275cmp=e.VBU({type:s,selectors:[["app-region-list"]],standalone:!0,features:[e.aNF],decls:40,vars:10,consts:[[1,"container-fluid"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"h3","mb-1"],[1,"text-muted"],["routerLink","/regions/create",1,"btn","btn-primary"],[1,"bi","bi-plus-circle","me-1"],[1,"card","mb-4"],[1,"card-body"],[1,"row"],[1,"col-md-6"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-search"],["type","text","placeholder","Search regions...",1,"form-control",3,"ngModelChange","keyup.enter","ngModel"],[1,"card"],[1,"card-header","d-flex","justify-content-between","align-items-center"],[1,"card-title","mb-0"],[1,"bi","bi-geo-alt-fill","me-2"],[1,"d-flex","align-items-center"],[1,"text-muted","me-2"],[1,"form-select","form-select-sm","w-auto",3,"ngModelChange","change","ngModel"],[3,"value"],["class","text-center py-4",4,"ngIf"],["class","text-center py-5",4,"ngIf"],["class","table-responsive",4,"ngIf"],["aria-label","Page navigation",4,"ngIf"],[1,"text-center","py-4"],["role","status",1,"spinner-border","text-primary"],[1,"visually-hidden"],[1,"mt-2"],[1,"text-center","py-5"],[1,"bi","bi-geo-alt","text-muted",2,"font-size","3rem"],[1,"text-muted","mt-3"],[1,"table-responsive"],[1,"table","table-hover"],[1,"table-light"],[1,"sortable",3,"click"],[1,"bi"],[4,"ngFor","ngForOf"],[1,"badge","bg-primary"],[1,"badge"],["role","group",1,"btn-group","btn-group-sm"],["type","button",1,"btn","btn-outline-primary",3,"click"],[1,"bi","bi-pencil"],["type","button",1,"btn","btn-outline-warning",3,"click"],["type","button",1,"btn","btn-outline-danger",3,"click"],[1,"bi","bi-trash"],["aria-label","Page navigation"],[1,"pagination","justify-content-center"],[1,"page-item"],[1,"page-link",3,"click","disabled"],["class","page-item",3,"active",4,"ngFor","ngForOf"],[1,"page-link",3,"click"]],template:function(n,i){1&n&&(e.j41(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),e.EFF(4,"Regions"),e.k0s(),e.j41(5,"p",3),e.EFF(6,"Manage Tanzania regions"),e.k0s()(),e.j41(7,"a",4),e.nrm(8,"i",5),e.EFF(9," Add Region "),e.k0s()(),e.j41(10,"div",6)(11,"div",7)(12,"div",8)(13,"div",9)(14,"div",10)(15,"span",11),e.nrm(16,"i",12),e.k0s(),e.j41(17,"input",13),e.mxI("ngModelChange",function(g){return e.DH7(i.searchTerm,g)||(i.searchTerm=g),g}),e.bIt("keyup.enter",function(){return i.onSearch()}),e.k0s()()()()()(),e.j41(18,"div",14)(19,"div",15)(20,"h5",16),e.nrm(21,"i",17),e.EFF(22," All Regions "),e.k0s(),e.j41(23,"div",18)(24,"span",19),e.EFF(25,"Page Size:"),e.k0s(),e.j41(26,"select",20),e.mxI("ngModelChange",function(g){return e.DH7(i.pageSize,g)||(i.pageSize=g),g}),e.bIt("change",function(){return i.onPageSizeChange()}),e.j41(27,"option",21),e.EFF(28,"10"),e.k0s(),e.j41(29,"option",21),e.EFF(30,"25"),e.k0s(),e.j41(31,"option",21),e.EFF(32,"50"),e.k0s(),e.j41(33,"option",21),e.EFF(34,"100"),e.k0s()()()(),e.j41(35,"div",7),e.DNE(36,m,6,0,"div",22)(37,b,9,0,"div",23)(38,v,24,9,"div",24)(39,k,9,7,"nav",25),e.k0s()()()),2&n&&(e.R7$(17),e.R50("ngModel",i.searchTerm),e.R7$(9),e.R50("ngModel",i.pageSize),e.R7$(),e.Y8G("value",10),e.R7$(2),e.Y8G("value",25),e.R7$(2),e.Y8G("value",50),e.R7$(2),e.Y8G("value",100),e.R7$(3),e.Y8G("ngIf",i.isLoading),e.R7$(),e.Y8G("ngIf",!i.isLoading&&0===i.regions.length),e.R7$(),e.Y8G("ngIf",!i.isLoading&&i.regions.length>0),e.R7$(),e.Y8G("ngIf",!i.isLoading&&i.totalPages>1))},dependencies:[l.MD,l.Sq,l.bT,l.QX,u.iI,u.Wk,a.YN,a.xH,a.y7,a.me,a.wz,a.BC,a.vS],styles:[".container-fluid[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 1rem}.table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-top:none;font-weight:600;color:#495057}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]{border-radius:.25rem}.btn-group[_ngcontent-%COMP%]   .btn[_ngcontent-%COMP%]:not(:last-child){margin-right:2px}.badge[_ngcontent-%COMP%]{font-size:.75em}.sortable[_ngcontent-%COMP%]{cursor:pointer;-webkit-user-select:none;user-select:none}.sortable[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-left:5px;font-size:.7em}"]})}}return s})()}}]);