"use strict";(self.webpackChunktaarifu_engine_dash=self.webpackChunktaarifu_engine_dash||[]).push([[590],{1590:(re,j,s)=>{s.r(j),s.d(j,{VillageFormComponent:()=>le});var I=s(177),R=s(1069),o=s(4341),e=s(4438),T=s(3832),L=s(4486),N=s(3446),M=s(5996);function G(l,n){1&l&&(e.j41(0,"div",57),e.EFF(1," Village name is required "),e.k0s())}function P(l,n){1&l&&(e.j41(0,"div",57),e.EFF(1," Village name must not exceed 100 characters "),e.k0s())}function U(l,n){1&l&&(e.j41(0,"div",57),e.EFF(1," Headquarters is required "),e.k0s())}function y(l,n){1&l&&(e.j41(0,"div",57),e.EFF(1," Headquarters must not exceed 100 characters "),e.k0s())}function W(l,n){if(1&l&&(e.j41(0,"option",43),e.EFF(1),e.k0s()),2&l){const t=n.$implicit;e.Y8G("value",t.id),e.R7$(),e.JRh(t.name)}}function Y(l,n){1&l&&(e.j41(0,"div",57),e.EFF(1," Region is required "),e.k0s())}function B(l,n){if(1&l&&(e.j41(0,"option",43),e.EFF(1),e.k0s()),2&l){const t=n.$implicit;e.Y8G("value",t.id),e.R7$(),e.JRh(t.name)}}function K(l,n){1&l&&(e.j41(0,"div",57),e.EFF(1," District is required "),e.k0s())}function x(l,n){if(1&l&&(e.j41(0,"option",43),e.EFF(1),e.k0s()),2&l){const t=n.$implicit;e.Y8G("value",t.id),e.R7$(),e.JRh(t.name)}}function X(l,n){1&l&&(e.j41(0,"div",57),e.EFF(1," Ward is required "),e.k0s())}function H(l,n){1&l&&(e.j41(0,"div",57),e.EFF(1," Population must be a positive number "),e.k0s())}function J(l,n){1&l&&(e.j41(0,"div",57),e.EFF(1," Area must be a positive number "),e.k0s())}function z(l,n){1&l&&(e.j41(0,"div",57),e.EFF(1," Latitude must be between -90 and 90 "),e.k0s())}function Q(l,n){1&l&&(e.j41(0,"div",57),e.EFF(1," Longitude must be between -180 and 180 "),e.k0s())}function Z(l,n){1&l&&(e.j41(0,"div",57),e.EFF(1," Executive officer name must not exceed 100 characters "),e.k0s())}function ee(l,n){1&l&&(e.j41(0,"div",57),e.EFF(1," Description must not exceed 500 characters "),e.k0s())}function ie(l,n){1&l&&e.nrm(0,"span",58)}function te(l,n){1&l&&e.nrm(0,"i",59)}let le=(()=>{class l{constructor(t,r,i,a,d,g,m){this.fb=t,this.villageService=r,this.wardService=i,this.districtService=a,this.regionService=d,this.route=g,this.router=m,this.isEditMode=!1,this.isLoading=!1,this.villageId=null,this.regions=[],this.districts=[],this.wards=[],this.filteredDistricts=[],this.filteredWards=[],this.villageForm=this.fb.group({name:["",[o.k0.required,o.k0.maxLength(100)]],headquarters:["",[o.k0.required,o.k0.maxLength(100)]],regionId:[null,[o.k0.required]],districtId:[null,[o.k0.required]],wardId:[null,[o.k0.required]],population:[0,[o.k0.min(0)]],areaSqKm:[0,[o.k0.min(0)]],latitude:[0,[o.k0.min(-90),o.k0.max(90)]],longitude:[0,[o.k0.min(-180),o.k0.max(180)]],executiveOfficer:["",[o.k0.maxLength(100)]],description:["",[o.k0.maxLength(500)]],isActive:[!0]})}ngOnInit(){this.loadRegions(),this.loadDistricts(),this.loadWards(),this.villageId=this.route.snapshot.paramMap.get("uid"),this.villageId&&(this.isEditMode=!0,this.loadVillage(this.villageId))}loadRegions(){this.regionService.getAllRegions(0,1e3).subscribe({next:t=>{this.regions=t.data||[]},error:t=>{console.error("Error loading regions:",t)}})}loadDistricts(){console.log("Loading districts..."),this.districtService.getAllDistricts(0,1e3).subscribe({next:t=>{this.districts=t.data||[],this.filteredDistricts=this.districts,console.log("Loaded districts:",this.districts),console.log("Sample district structure:",this.districts[0])},error:t=>{console.error("Error loading districts:",t)}})}loadWards(){console.log("Loading wards..."),this.wardService.getAllWards(0,1e3).subscribe({next:t=>{this.wards=t.data||[],this.filteredWards=this.wards,console.log("Loaded wards:",this.wards),console.log("Sample ward structure:",this.wards[0])},error:t=>{console.error("Error loading wards:",t)}})}loadVillage(t){this.isLoading=!0,console.log("Loading village with UID:",t),this.villageService.getVillageByUid(t).subscribe({next:r=>{if(this.isLoading=!1,console.log("Village API Response:",r),r.status){const i=r.data;console.log("Village data:",i),this.villageForm.patchValue({name:i.name,headquarters:i.headquarters,regionId:i.regionId,districtId:i.districtId,wardId:i.wardId,population:i.population,areaSqKm:i.areaSqKm,latitude:i.latitude,longitude:i.longitude,executiveOfficer:i.executiveOfficer,description:i.description,isActive:i.isActive}),this.onRegionChange(),this.onDistrictChange()}},error:r=>{this.isLoading=!1,console.error("Error loading village:",r),console.error("Error status:",r.status),console.error("Error details:",r.error),alert(`Error loading village: ${r.error?.message||r.message||"Unknown error"}`),this.goBack()}})}onRegionChange(){const t=this.villageForm.get("regionId")?.value;if(console.log("Region changed to:",t),t){const r=this.regions.find(i=>i.id===Number(t));console.log("Selected region:",r),r&&this.districtService.getDistrictsByRegionUid(r.uid,0,1e3).subscribe({next:i=>{this.filteredDistricts=i.data||[],console.log("Loaded districts for region",r.name,":",this.filteredDistricts);const a=this.villageForm.get("districtId")?.value;a&&!this.filteredDistricts.find(d=>d.id===a)&&this.villageForm.patchValue({districtId:null,wardId:null}),this.onDistrictChange()},error:i=>{console.error("Error loading districts for region:",i),this.filteredDistricts=[]}})}else this.filteredDistricts=this.districts,console.log("No region selected, showing all districts:",this.filteredDistricts)}onDistrictChange(){const t=this.villageForm.get("districtId")?.value;if(console.log("District changed to:",t),t){const r=this.filteredDistricts.find(i=>i.id===Number(t));console.log("Selected district:",r),r&&this.wardService.getWardsByDistrictUid(r.uid,0,1e3).subscribe({next:i=>{this.filteredWards=i.data||[],console.log("Loaded wards for district",r.name,":",this.filteredWards);const a=this.villageForm.get("wardId")?.value;a&&!this.filteredWards.find(d=>d.id===a)&&this.villageForm.patchValue({wardId:null})},error:i=>{console.error("Error loading wards for district:",i),this.filteredWards=[]}})}else this.filteredWards=this.wards,console.log("No district selected, showing all wards:",this.filteredWards)}onSubmit(){if(this.villageForm.valid){this.isLoading=!0;const t=this.villageForm.value;this.isEditMode&&this.villageId?this.villageService.updateVillage(this.villageId,{name:t.name,headquarters:t.headquarters,wardId:t.wardId,population:t.population,areaSqKm:t.areaSqKm,latitude:t.latitude,longitude:t.longitude,executiveOfficer:t.executiveOfficer,description:t.description,isActive:t.isActive}).subscribe({next:i=>{this.isLoading=!1,i.status&&(alert("Village updated successfully!"),this.goBack())},error:i=>{this.isLoading=!1,console.error("Error updating village:",i),alert(`Error updating village: ${i.error?.message||i.message||"Unknown error"}`)}}):this.villageService.createVillage({name:t.name,headquarters:t.headquarters,wardId:t.wardId,population:t.population,areaSqKm:t.areaSqKm,latitude:t.latitude,longitude:t.longitude,executiveOfficer:t.executiveOfficer,description:t.description,isActive:t.isActive}).subscribe({next:i=>{this.isLoading=!1,i.status&&(alert("Village created successfully!"),this.goBack())},error:i=>{this.isLoading=!1,console.error("Error creating village:",i),alert(`Error creating village: ${i.error?.message||i.message||"Unknown error"}`)}})}else Object.keys(this.villageForm.controls).forEach(t=>{this.villageForm.get(t)?.markAsTouched()})}goBack(){this.router.navigate(["/villages"])}static{this.\u0275fac=function(r){return new(r||l)(e.rXU(o.ok),e.rXU(T.M),e.rXU(L.U),e.rXU(N.m),e.rXU(M.S),e.rXU(R.nX),e.rXU(R.Ix))}}static{this.\u0275cmp=e.VBU({type:l,selectors:[["app-village-form"]],standalone:!0,features:[e.aNF],decls:158,vars:47,consts:[[1,"village-form-container"],[1,"d-flex","justify-content-between","align-items-center","mb-4"],[1,"h3","mb-1"],[1,"text-muted"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-arrow-left","me-1"],[1,"row"],[1,"col-lg-8"],[1,"card"],[1,"card-header"],[1,"card-title","mb-0"],[1,"bi","bi-house-door","me-2"],[1,"card-body"],[3,"ngSubmit","formGroup"],[1,"row","g-3"],[1,"col-md-6"],["for","name",1,"form-label"],[1,"text-danger"],["type","text","id","name","formControlName","name","placeholder","Enter village name",1,"form-control"],["class","invalid-feedback",4,"ngIf"],["for","headquarters",1,"form-label"],["type","text","id","headquarters","formControlName","headquarters","placeholder","Enter headquarters",1,"form-control"],[1,"col-md-4"],["for","regionId",1,"form-label"],["id","regionId","formControlName","regionId",1,"form-select",3,"change"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","districtId",1,"form-label"],["id","districtId","formControlName","districtId",1,"form-select",3,"change"],["for","wardId",1,"form-label"],["id","wardId","formControlName","wardId",1,"form-select"],["for","population",1,"form-label"],["type","number","id","population","formControlName","population","placeholder","Enter population","min","0",1,"form-control"],["for","areaSqKm",1,"form-label"],["type","number","id","areaSqKm","formControlName","areaSqKm","placeholder","Enter area in square kilometers","min","0","step","0.1",1,"form-control"],["for","latitude",1,"form-label"],["type","number","id","latitude","formControlName","latitude","placeholder","Enter latitude","step","0.000001",1,"form-control"],["for","longitude",1,"form-label"],["type","number","id","longitude","formControlName","longitude","placeholder","Enter longitude","step","0.000001",1,"form-control"],["for","executiveOfficer",1,"form-label"],["type","text","id","executiveOfficer","formControlName","executiveOfficer","placeholder","Enter executive officer name",1,"form-control"],["for","isActive",1,"form-label"],["id","isActive","formControlName","isActive",1,"form-select"],[3,"value"],[1,"col-12"],["for","description",1,"form-label"],["id","description","formControlName","description","rows","3","placeholder","Enter village description",1,"form-control"],[1,"row","mt-4"],[1,"d-flex","gap-2"],["type","submit",1,"btn","btn-primary",3,"disabled"],["class","spinner-border spinner-border-sm me-2","role","status",4,"ngIf"],["class","bi bi-check-circle me-1",4,"ngIf"],[1,"bi","bi-x-circle","me-1"],[1,"col-lg-4"],[1,"bi","bi-info-circle","me-2"],[1,"list-unstyled","small","text-muted"],[1,"mt-3"],[1,"invalid-feedback"],["role","status",1,"spinner-border","spinner-border-sm","me-2"],[1,"bi","bi-check-circle","me-1"]],template:function(r,i){if(1&r&&(e.j41(0,"div",0)(1,"div",1)(2,"div")(3,"h1",2),e.EFF(4),e.k0s(),e.j41(5,"p",3),e.EFF(6),e.k0s()(),e.j41(7,"button",4),e.bIt("click",function(){return i.goBack()}),e.nrm(8,"i",5),e.EFF(9," Back to Villages "),e.k0s()(),e.j41(10,"div",6)(11,"div",7)(12,"div",8)(13,"div",9)(14,"h5",10),e.nrm(15,"i",11),e.EFF(16," Village Information "),e.k0s()(),e.j41(17,"div",12)(18,"form",13),e.bIt("ngSubmit",function(){return i.onSubmit()}),e.j41(19,"div",14)(20,"div",15)(21,"label",16),e.EFF(22,"Village Name "),e.j41(23,"span",17),e.EFF(24,"*"),e.k0s()(),e.nrm(25,"input",18),e.DNE(26,G,2,0,"div",19)(27,P,2,0,"div",19),e.k0s(),e.j41(28,"div",15)(29,"label",20),e.EFF(30,"Headquarters "),e.j41(31,"span",17),e.EFF(32,"*"),e.k0s()(),e.nrm(33,"input",21),e.DNE(34,U,2,0,"div",19)(35,y,2,0,"div",19),e.k0s(),e.j41(36,"div",22)(37,"label",23),e.EFF(38,"Region "),e.j41(39,"span",17),e.EFF(40,"*"),e.k0s()(),e.j41(41,"select",24),e.bIt("change",function(){return i.onRegionChange()}),e.j41(42,"option",25),e.EFF(43,"Select a region"),e.k0s(),e.DNE(44,W,2,2,"option",26),e.k0s(),e.DNE(45,Y,2,0,"div",19),e.k0s(),e.j41(46,"div",22)(47,"label",27),e.EFF(48,"District "),e.j41(49,"span",17),e.EFF(50,"*"),e.k0s()(),e.j41(51,"select",28),e.bIt("change",function(){return i.onDistrictChange()}),e.j41(52,"option",25),e.EFF(53,"Select a district"),e.k0s(),e.DNE(54,B,2,2,"option",26),e.k0s(),e.DNE(55,K,2,0,"div",19),e.k0s(),e.j41(56,"div",22)(57,"label",29),e.EFF(58,"Ward "),e.j41(59,"span",17),e.EFF(60,"*"),e.k0s()(),e.j41(61,"select",30)(62,"option",25),e.EFF(63,"Select a ward"),e.k0s(),e.DNE(64,x,2,2,"option",26),e.k0s(),e.DNE(65,X,2,0,"div",19),e.k0s(),e.j41(66,"div",15)(67,"label",31),e.EFF(68,"Population"),e.k0s(),e.nrm(69,"input",32),e.DNE(70,H,2,0,"div",19),e.k0s(),e.j41(71,"div",15)(72,"label",33),e.EFF(73,"Area (km\xb2)"),e.k0s(),e.nrm(74,"input",34),e.DNE(75,J,2,0,"div",19),e.k0s(),e.j41(76,"div",15)(77,"label",35),e.EFF(78,"Latitude"),e.k0s(),e.nrm(79,"input",36),e.DNE(80,z,2,0,"div",19),e.k0s(),e.j41(81,"div",15)(82,"label",37),e.EFF(83,"Longitude"),e.k0s(),e.nrm(84,"input",38),e.DNE(85,Q,2,0,"div",19),e.k0s(),e.j41(86,"div",15)(87,"label",39),e.EFF(88,"Executive Officer"),e.k0s(),e.nrm(89,"input",40),e.DNE(90,Z,2,0,"div",19),e.k0s(),e.j41(91,"div",15)(92,"label",41),e.EFF(93,"Status"),e.k0s(),e.j41(94,"select",42)(95,"option",43),e.EFF(96,"Active"),e.k0s(),e.j41(97,"option",43),e.EFF(98,"Inactive"),e.k0s()()(),e.j41(99,"div",44)(100,"label",45),e.EFF(101,"Description"),e.k0s(),e.nrm(102,"textarea",46),e.DNE(103,ee,2,0,"div",19),e.k0s()(),e.j41(104,"div",47)(105,"div",44)(106,"div",48)(107,"button",49),e.DNE(108,ie,1,0,"span",50)(109,te,1,0,"i",51),e.EFF(110),e.k0s(),e.j41(111,"button",4),e.bIt("click",function(){return i.goBack()}),e.nrm(112,"i",52),e.EFF(113," Cancel "),e.k0s()()()()()()()(),e.j41(114,"div",53)(115,"div",8)(116,"div",9)(117,"h6",10),e.nrm(118,"i",54),e.EFF(119," Help & Guidelines "),e.k0s()(),e.j41(120,"div",12)(121,"h6"),e.EFF(122,"Required Fields"),e.k0s(),e.j41(123,"ul",55)(124,"li"),e.EFF(125,"\u2022 Village Name"),e.k0s(),e.j41(126,"li"),e.EFF(127,"\u2022 Headquarters"),e.k0s(),e.j41(128,"li"),e.EFF(129,"\u2022 Region"),e.k0s(),e.j41(130,"li"),e.EFF(131,"\u2022 District"),e.k0s(),e.j41(132,"li"),e.EFF(133,"\u2022 Ward"),e.k0s()(),e.j41(134,"h6",56),e.EFF(135,"Optional Fields"),e.k0s(),e.j41(136,"ul",55)(137,"li"),e.EFF(138,"\u2022 Population"),e.k0s(),e.j41(139,"li"),e.EFF(140,"\u2022 Area (km\xb2)"),e.k0s(),e.j41(141,"li"),e.EFF(142,"\u2022 Coordinates"),e.k0s(),e.j41(143,"li"),e.EFF(144,"\u2022 Executive Officer"),e.k0s(),e.j41(145,"li"),e.EFF(146,"\u2022 Description"),e.k0s()(),e.j41(147,"h6",56),e.EFF(148,"Tips"),e.k0s(),e.j41(149,"ul",55)(150,"li"),e.EFF(151,"\u2022 Select region first to filter districts"),e.k0s(),e.j41(152,"li"),e.EFF(153,"\u2022 Select district to filter wards"),e.k0s(),e.j41(154,"li"),e.EFF(155,"\u2022 Use precise coordinates for mapping"),e.k0s(),e.j41(156,"li"),e.EFF(157,"\u2022 Keep descriptions concise and informative"),e.k0s()()()()()()()),2&r){let a,d,g,m,C,D,u,V,c,w,v,O,f,$,h,q,p,F,_,E,k,S,b,A;e.R7$(4),e.JRh(i.isEditMode?"Edit Village":"Create New Village"),e.R7$(2),e.JRh(i.isEditMode?"Update village information":"Add a new village to the system"),e.R7$(12),e.Y8G("formGroup",i.villageForm),e.R7$(7),e.AVh("is-invalid",(null==(a=i.villageForm.get("name"))?null:a.invalid)&&(null==(a=i.villageForm.get("name"))?null:a.touched)),e.R7$(),e.Y8G("ngIf",null==(d=i.villageForm.get("name"))?null:d.hasError("required")),e.R7$(),e.Y8G("ngIf",null==(g=i.villageForm.get("name"))?null:g.hasError("maxlength")),e.R7$(6),e.AVh("is-invalid",(null==(m=i.villageForm.get("headquarters"))?null:m.invalid)&&(null==(m=i.villageForm.get("headquarters"))?null:m.touched)),e.R7$(),e.Y8G("ngIf",null==(C=i.villageForm.get("headquarters"))?null:C.hasError("required")),e.R7$(),e.Y8G("ngIf",null==(D=i.villageForm.get("headquarters"))?null:D.hasError("maxlength")),e.R7$(6),e.AVh("is-invalid",(null==(u=i.villageForm.get("regionId"))?null:u.invalid)&&(null==(u=i.villageForm.get("regionId"))?null:u.touched)),e.R7$(3),e.Y8G("ngForOf",i.regions),e.R7$(),e.Y8G("ngIf",null==(V=i.villageForm.get("regionId"))?null:V.hasError("required")),e.R7$(6),e.AVh("is-invalid",(null==(c=i.villageForm.get("districtId"))?null:c.invalid)&&(null==(c=i.villageForm.get("districtId"))?null:c.touched)),e.R7$(3),e.Y8G("ngForOf",i.filteredDistricts),e.R7$(),e.Y8G("ngIf",null==(w=i.villageForm.get("districtId"))?null:w.hasError("required")),e.R7$(6),e.AVh("is-invalid",(null==(v=i.villageForm.get("wardId"))?null:v.invalid)&&(null==(v=i.villageForm.get("wardId"))?null:v.touched)),e.R7$(3),e.Y8G("ngForOf",i.filteredWards),e.R7$(),e.Y8G("ngIf",null==(O=i.villageForm.get("wardId"))?null:O.hasError("required")),e.R7$(4),e.AVh("is-invalid",(null==(f=i.villageForm.get("population"))?null:f.invalid)&&(null==(f=i.villageForm.get("population"))?null:f.touched)),e.R7$(),e.Y8G("ngIf",null==($=i.villageForm.get("population"))?null:$.hasError("min")),e.R7$(4),e.AVh("is-invalid",(null==(h=i.villageForm.get("areaSqKm"))?null:h.invalid)&&(null==(h=i.villageForm.get("areaSqKm"))?null:h.touched)),e.R7$(),e.Y8G("ngIf",null==(q=i.villageForm.get("areaSqKm"))?null:q.hasError("min")),e.R7$(4),e.AVh("is-invalid",(null==(p=i.villageForm.get("latitude"))?null:p.invalid)&&(null==(p=i.villageForm.get("latitude"))?null:p.touched)),e.R7$(),e.Y8G("ngIf",(null==(F=i.villageForm.get("latitude"))?null:F.hasError("min"))||(null==(F=i.villageForm.get("latitude"))?null:F.hasError("max"))),e.R7$(4),e.AVh("is-invalid",(null==(_=i.villageForm.get("longitude"))?null:_.invalid)&&(null==(_=i.villageForm.get("longitude"))?null:_.touched)),e.R7$(),e.Y8G("ngIf",(null==(E=i.villageForm.get("longitude"))?null:E.hasError("min"))||(null==(E=i.villageForm.get("longitude"))?null:E.hasError("max"))),e.R7$(4),e.AVh("is-invalid",(null==(k=i.villageForm.get("executiveOfficer"))?null:k.invalid)&&(null==(k=i.villageForm.get("executiveOfficer"))?null:k.touched)),e.R7$(),e.Y8G("ngIf",null==(S=i.villageForm.get("executiveOfficer"))?null:S.hasError("maxlength")),e.R7$(5),e.Y8G("value",!0),e.R7$(2),e.Y8G("value",!1),e.R7$(5),e.AVh("is-invalid",(null==(b=i.villageForm.get("description"))?null:b.invalid)&&(null==(b=i.villageForm.get("description"))?null:b.touched)),e.R7$(),e.Y8G("ngIf",null==(A=i.villageForm.get("description"))?null:A.hasError("maxlength")),e.R7$(4),e.Y8G("disabled",i.villageForm.invalid||i.isLoading),e.R7$(),e.Y8G("ngIf",i.isLoading),e.R7$(),e.Y8G("ngIf",!i.isLoading),e.R7$(),e.SpI(" ",i.isEditMode?"Update Village":"Create Village"," ")}},dependencies:[I.MD,I.Sq,I.bT,R.iI,o.X1,o.qT,o.xH,o.y7,o.me,o.Q0,o.wz,o.BC,o.cb,o.VZ,o.j4,o.JD],styles:[".village-form-container[_ngcontent-%COMP%]{max-width:1200px;margin:0 auto;padding:0 1rem}.card[_ngcontent-%COMP%]{border:none;box-shadow:0 .125rem .25rem #00000013}.card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid #dee2e6}.form-label[_ngcontent-%COMP%]{font-weight:500;color:#495057}.text-danger[_ngcontent-%COMP%]{color:#dc3545!important}.btn[_ngcontent-%COMP%]{font-weight:500}.spinner-border-sm[_ngcontent-%COMP%]{width:1rem;height:1rem}"]})}}return l})()}}]);